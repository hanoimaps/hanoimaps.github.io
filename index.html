<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css"
      type="text/css"
    />
    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
    <title>Hanoi 1936</title>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      /* Đảm bảo bản đồ chiếm toàn bộ viewport */
      #map {
        height: 100vh;
        width: 100%;
        position: relative;
      }
      #opacity-slider {
        position: absolute;
        z-index: 1000;
        bottom: 20px;
        right: 20px;
        width: 200px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <input
      type="range"
      id="opacity-slider"
      min="0"
      max="1"
      step="0.01"
      value="0.7"
      aria-label="opacity"
    />

    <script>
      const { Map, View } = ol;
      const { Tile: TileLayer } = ol.layer;
      const { OSM, XYZ } = ol.source;
      const { fromLonLat } = ol.proj;

      const ALLMAPS_TILE_URL =
        "https://allmaps.xyz/images/e96b97a4f6272246/{z}/{x}/{y}.png";
      const INITIAL_OPACITY = 0.7;

      // 1. Khởi tạo Lớp Bản đồ Cũ (Vintage Layer)
      const vintageLayer = new ol.layer.Tile({
        source: new XYZ({
          url: ALLMAPS_TILE_URL,
          wrapX: false, // Ngăn bản đồ bị lặp lại theo chiều ngang
        }),
        opacity: INITIAL_OPACITY,
      });

      // 2. Khởi tạo Bản đồ OpenLayers
      const map = new Map({
        target: "map",
        layers: [
          // Lớp 1: Bản đồ Nền hiện tại (OSM)
          new ol.layer.Tile({
            source: new OSM(),
          }),
          // Lớp 2: Bản đồ Vintage (Overlay)
          vintageLayer,
        ],
        // Cài đặt View: Tập trung vào khu vực Hà Nội
        view: new View({
          center: fromLonLat([105.84, 21.02]),
          zoom: 13,
        }),
      });

      // 3. Logic điều khiển Thanh Trượt Độ Mờ
      const opacitySlider = document.getElementById("opacity-slider");
      opacitySlider.value = INITIAL_OPACITY;
      opacitySlider.addEventListener("input", (e) => {
        vintageLayer.setOpacity(parseFloat(e.target.value));
      });
    </script>

    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/service-worker.js")
            .then((registration) => {
              console.log(
                "Service Worker registered with scope:",
                registration.scope
              );
            })
            .catch((error) => {
              console.error("Service Worker registration failed:", error);
            });
        });
      }
    </script>
  </body>
</html>
